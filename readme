# Widget Workshop
I denne workshopen skal du lære å opprette widgets i et iOS swift prosjekt.

<details>
<summary>1. Legge til en widget</summary>

## 1.0 - Legge til en widget
For å legge til en widget må du:
1. Velg prosjektet i Xcode i explorer. 
![Select the project](readme_images/start_project_screenshot.png)
2. Deretter trykker du på plus-tegnet nederst i "General". 
![Press the plus icon](readme_images/start_project_plus.png)
3. Søk etter widget i vinduet som dukker opp. 
![Search for widget](readme_images/search_for_widget.png)
4. Velg et navn på widgeten
![Give new extension a name](readme_images/give_extension_product_name.png)
5. Du får spørsmål om scheme, her er det ikke så farlig hva du velger. Men trykk gjerne activate. Se punkt under om scheme.
![Do you want to change scheme prompt](readme_images/do_you_want_scheme.png)
6. Naviger til den nye mappen som ble lagt til, med navnet du valgte i tidligere steg.
7. Åpne filen med samme navn som mappen. Du bør kunne se en widget dukke opp i preview.

![picture showing the new files](readme_images/find_new_widget_files.png)


### Gratulerer du har lagt til en widget til iOS prosjektet.
Nå må vi forstå hva de er vi har lagt til.

</details>


<details>
<summary>Hva er scheme?</summary>

### Scheme
Tidligere fikk du spørsmål fra XCode om du ønsket å aktivere scheme for widgeten. Det scheme gjør er (grovt forenklet) å si hvilket produkt i prosjektet ditt du ønsker å bygge og kjøre på en simulator eller telefon.

Du kan enkelt endre dette når som helst ved å trykke på produktet/valgt scheme øverst i XCode. 

![Change scheme](readme_images/change_scheme_1.png)
![Change scheme dropdown](readme_images/change_scheme_2.png)
Hvis man jobber med ulike produkter som Widget, iOS App, WatchOS app, så bytter man ofte mellom disse.
</details>

<details>
<summary>2. Hva har vi lagt til?</summary>


## 2.0 
*Her forklares hva vi har lagt til av kode fra Apple. Hvis du ikke er interessert kan du hoppe rett til punkt 3.*

I den nye mappen som ble generert ligger det fire filer. Nå inneholder de eksempelkode fra Apple for deres "Emoji Ranger Widget". 

Alle filene begynner med navnet du valgte på widgtenen. Vi kommer til å kalle den for "widget_navn" i guiden. Filene er altså:

1. widget_navn
2. widget_navn_widgetBundle
3. widget_navn_widgetControl
4. widget_navn_widgetLiveActivity
5. AppIntent

<details>
<summary>widget_navn</summary>

### widget_navn
Denne filen er selve widgeten, og det er her vi kommer til å jobbe mest i dag. Dette er filen som lager widget som lever på hjemskjermen og låseskjermen på iPhone. Nå inneholder filen et autogenerert widget-eksempel med noen emojis.

</details>

<details>
<summary>widget_navn_widgetLiveActivity</summary>

### widget_navn_widgetLiveActivity
Denne filen er en såkalt "Live Activity" widget. Hvis du har kjøpt en kollektivtrafikkbillett, eller bestilt mat fra wolt/foodora kan det hende du har sett en timer på låseskjermen på iPhone som sier hvor lenge det er igjen av billetten din, eller hvor lenge det er til maten ankommer. Disse er "Live Activites". Hvis du ønsker en slik i din app, så er denne filen et autogenerert eksempel fra Apple.

https://developer.apple.com/documentation/activitykit/displaying-live-data-with-live-activities

</details>

<details>
<summary>widget_navn_widgetControl</summary>

### widget_navn_widgetControl
Dette er en "Control Widget". For å la brukere konfigurere widgets (endre farge, endre hvilke felt som vises i widgeten), så kan man legge til en Control Widget. 

En bruker vil da kunne "long-presse" på en widget, for å få opp Control Widgeten. 

Du kan tenke på det som et ekstra view på widgeten hvor man kan endre på settings.

Filen har autogenerert eksempelkode for Apple sin Emoji Ranger widget.

https://developer.apple.com/documentation/swiftui/controlwidget

Se hvordan det fungerer med emoji-ranger eksempelet fra apple:
1. Long press på widgeten på hjemskjermen
![Widget on home screen](readme_images/running_widget_on_simulator.png)

2. Etter å ha longpressed vil du se en meny, velg "Edit Widget"
![Long press widget](readme_images/long_press_widget.png)

3. Du skal nå se Widget Control-koden din på devicen / simulatoren du kjører på. Kjenner du igjen koden?
![View of widget control](readme_images/edit_widget_control_widget.png)

4. Prøv å endre teksten på favourite emoji.
![Change favourite emoji in widget control](readme_images/widget_control_changed_favourite_emoji.png)

5. Trykk utenfor Widget Control for å lukke den, og se resultatet av endringene på hjemskjermen i widgeten. ![Result of changed value in widget control](readme_images/result_of_chaning_widget_control.png)

</details>

<details>
<summary>widget_navn_widgetBundle</summary>

### widget_navn_widgetBundle
Dette er en fil som eksponerer widgetsene dine ut til iOS. Hvis du har laget flere widgets, som en home screen widget, og en live activity, så kan de wrappes i en widgetBundle slik at de alle blir tilgjengelige på iPhone hvis appen din er installert.

https://developer.apple.com/documentation/swiftui/widgetbundle

</details>

<details>
<summary>AppIntent (WidgetConfigurationIntent)</summary>

### WidgetConfigurationIntent

</details>


</details>

---

<details>
<summary>Prøv å kjør widget (fiks error)</summary>

### Kjør widgeten på simulator eller device
Kjør eksempel-widgeten på simulator ved å trykke play i XCode. Får du sett emoji-ranger widgeten? Prøv å long-presse for å få opp widget control.

### Feilsøking
Det kan hende du får feilen som på bildet her:
![Error running widget 1](readme_images/crash_running_example_widget.png)

![Error running widget highlight msg](readme_images/crash_running_example_widget_error_msg.png)

For å fikse dette må vi inn i scheme-et for widgeten og sette hvilken widget vi ønsker at xcode skal kjøre i gang på simulatoren / devicen din.

Følg bildene:

![Edit scheme dropdown](readme_images/change_scheme_1.png)

![Select the correct scheme for editing](readme_images/edit_widget_scheme.png)

![Locate widget kind name](readme_images/edit_widget_scheme_arguments.png)

![Set widget kind name](readme_images/edit_widget_scheme_widget_name_kind.png)

**OBS! Vær nøye med at du skriver inn nøyaktig samme string som widget-filen din heter**

Prøv å kjør på nytt. Nå skal det fungere.

![Running widget on simulator](readme_images/running_widget_on_simulator.png)

</details>

---

<details>
<summary>3 Hvordan fungerer widgeten?</summary>

### 3. Hvordan fungerer widgeten?
Før vi setter i gang med å endre widgeten må vi vite hvordan en widget kjører og fungerer.

TODO forklare funksjonene i widget-koden

</details>

<details>
<summary>4. Endre widget-koden</summary>

</details>

<details>

<summary>6. Shared storage</summary>

Antall timeline entires per døgn

Lov til å oppdatere hver gang inne i appen
(prøv å endre noe data ved app-open og la det oppdatere widget)

Forskjell på å kjøre via XCode og naturlig fra app-store installasjon (angry emoji)

</details>

<summary>5. Widget begrensninger</summary>

30 MB RAM -> widget killes hvis den overskrider

Antall timeline entires per døgn

Lov til å oppdatere hver gang inne i appen
(prøv å endre noe data ved app-open og la det oppdatere widget)

Forskjell på å kjøre via XCode og naturlig fra app-store installasjon (angry emoji)

</details>

